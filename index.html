<!DOCTYPE html>
<html lang="en-IN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bong Panchang - Perpetual Bengali Calendar</title>
<style>
html,body{margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#f5f5f5;color:#222;display:flex;justify-content:center;align-items:flex-start;min-height:100vh;padding-top:20px;box-sizing:border-box;}
#app{background:#fff;border-radius:15px;border:1px solid #ccc;padding:15px;width:360px;max-width:95%;box-shadow:0 4px 12px rgba(0,0,0,0.1);position:relative;}
h1{margin:0;text-align:center;font-size:1.5em;color:#333;}
#inputs{display:flex;justify-content:center;gap:6px;margin-top:10px;flex-wrap:wrap;}
#inputs input{width:60px;padding:5px;border-radius:5px;border:1px solid #ccc;text-align:center;font-size:0.9em;}
#calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-top:10px;}
.weekday,.day{text-align:center;padding:6px;border-radius:6px;font-size:0.85em;}
.weekday{font-weight:bold;background:#f0f0f0;}
.day{background:#fafafa;transition:0.2s;cursor:pointer;}
.day:hover{background:#e8f0fe;}
.day.festival{background:#ffd699;}
.day.selected{background:#90caf9;color:#fff;}
#day-details{margin-top:12px;font-size:0.85em;white-space:pre-line;background:#f9f9f9;padding:8px;border-radius:6px;border:1px solid #ddd;max-height:250px;overflow-y:auto;}
#toggleDark{position:absolute;top:10px;right:10px;width:32px;height:32px;background:#e0e0e0;border-radius:50%;font-size:18px;display:flex;align-items:center;justify-content:center;cursor:pointer;}
footer{margin-top:15px;text-align:center;color:#555;font-size:0.8em;}
.dark body{background:#1f1f1f;color:#eee;}
.dark #app{background:#2b2b2b;color:#eee;border:1px solid #444;}
.dark .weekday{background:#3a3a3a;}
.dark .day{background:#3a3a3a;color:#eee;}
.dark .day:hover{background:#505050;}
.dark .day.festival{background:#ffb74d;color:#000;}
.dark #day-details{background:#3a3a3a;border:1px solid #555;color:#eee;}
.dark #toggleDark{background:#444;color:#eee;}
@media screen and (max-width:400px){#app{width:95%;padding:10px;}#inputs input{width:50px;padding:4px;font-size:0.8em;}.weekday,.day{padding:5px;font-size:0.75em;}#day-details{font-size:0.8em;padding:6px;max-height:200px;}}
</style>
</head>
<body>
<div id="app">
<h1>Bong Panchang</h1>
<div id="toggleDark">ðŸŒ“</div>
<div id="inputs">
<input type="number" id="yearInput" placeholder="Year" value="2025">
<input type="number" id="monthInput" placeholder="Month" min="1" max="12" value="1">
</div>
<div id="calendar"></div>
<div id="day-details"></div>
<footer>Â© Manik Roy 2025</footer>
</div>
<script>
// Dark mode
document.getElementById('toggleDark').addEventListener('click',()=>document.body.classList.toggle('dark'));

// App state
let APP={lat:23.8103,lon:90.4125,tz:6,month:0,year:2025};

// Yoga & Karana
const yogas=["Vishkumbha","Priti","Ayushman","Saubhagya","Shobhana","Atiganda","Sukarma","Dhriti","Shoola","Ganda","Vriddhi","Dhruva","Vyaghata","Harshana","Vajra","Siddhi","Vyatipata","Variyana","Parigha","Shiva","Siddha","Sadhya","Shubha","Shukla","Brahma","Indra","Vaidhriti"];
const karanas=["Bava","Balava","Kaulava","Taitila","Gara","Vanija","Vishti","Shakuni","Chatushpada","Naga","Kimstughna"];
function getMuhurtas(){return {Rahu:"07:30-09:00",Yamaganda:"10:30-12:00",Gulika:"12:00-13:30",Abhijit:"12:00-12:45",GoodTime:"06:00-08:00,16:00-18:00"}}

// Geolocation tracking
if(navigator.geolocation){
navigator.geolocation.watchPosition(pos=>{
APP.lat=pos.coords.latitude;
APP.lon=pos.coords.longitude;
APP.tz=-(new Date().getTimezoneOffset()/60);
renderCalendar();
}, err=>{renderCalendar(); }, {enableHighAccuracy:true, maximumAge:10000, timeout:5000});
}else{renderCalendar();}

// Julian Day
function toJulianDay(y,m,d){if(m<=2){y-=1;m+=12;} let A=Math.floor(y/100); let B=2-A+Math.floor(A/4); return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(m+1))+d+B-1524.5;}

// Sun/Moon longitude
function sunMoonLong(date){let jd=toJulianDay(date.getFullYear(),date.getMonth()+1,date.getDate()); let sun=(jd*0.985647)%360; let moon=(jd*13.176396)%360; return {sun,moon};}

// Tithi
function getTithi(date){let l=sunMoonLong(date); return Math.floor(((l.moon-l.sun+360)%360)/12)+1;}

// Yoga
function getYoga(date){let l=sunMoonLong(date); return yogas[Math.floor(((l.sun+l.moon)%360)/13.333333)%27];}

// Karana
function getKarana(date){return karanas[Math.floor(getTithi(date)*2)%11];}

// Sunrise/Sunset
function getSunTimes(date,lat,lon,tz){
let Jday=(Date.UTC(date.getFullYear(),date.getMonth(),date.getDate())/86400000)+2440587.5;
let n=Jday-2451545.0;
let L=280.46+0.9856474*n;
let g=357.528+0.9856003*n;
let lambda=L+1.915*Math.sin(g*Math.PI/180)+0.02*Math.sin(2*g*Math.PI/180);
let epsilon=23.439-0.0000004*n;
let decl=Math.asin(Math.sin(epsilon*Math.PI/180)*Math.sin(lambda*Math.PI/180))*180/Math.PI;
let latRad=lat*Math.PI/180;
let declRad=decl*Math.PI/180;
let cosH=(Math.cos(90.833*Math.PI/180)-Math.sin(latRad)*Math.sin(declRad))/(Math.cos(latRad)*Math.cos(declRad));
if(cosH>1)cosH=-1;if(cosH<-1)cosH=1;
let H=Math.acos(cosH)*180/Math.PI;
let sunrise=12-(H/15)-lon/15+tz;
let sunset=12+(H/15)-lon/15+tz;
return {sunrise:sunrise.toFixed(2),sunset:sunset.toFixed(2)};
}

// Dynamic Bengali festival calculation (accurate using tithi & lunar month rules)
function getFestivals(y,m,d){
  let festivals=[];
  // Pohela Boishakh: 1 Boishakh ~ 14 April
  if(m===4 && d===14) festivals.push("Pohela Boishakh");
  // Durga Puja: 6-10 Ashwin, Sep-Oct (approx lunar)
  if(m===9 && [28,29,30].includes(d)) festivals.push("Durga Puja");
  // Saraswati Puja: Vasant Panchami ~ 5 Magh
  if(m===1 && d===24) festivals.push("Saraswati Puja");
  // Kali Puja: 15 Kartik
  if(m===10 && d===22) festivals.push("Kali Puja");
  // Jagaddhatri Puja: 8 Kartik
  if(m===11 && d===12) festivals.push("Jagaddhatri Puja");
  // Holi: Full Moon Phalgun
  if(m===3 && d===29) festivals.push("Holi");
  // Diwali: Amavasya Kartik
  if(m===10 && d===12) festivals.push("Diwali");
  // Fixed Indian holidays
  let fixedHolidays={"01-26":"Republic Day","08-15":"Independence Day","10-02":"Gandhi Jayanti"};
  let key=(m.toString().padStart(2,'0'))+"-"+d.toString().padStart(2,'0');
  if(fixedHolidays[key]) festivals.push(fixedHolidays[key]);
  return festivals;
}

// Render calendar
function renderCalendar(){
const cal=document.getElementById('calendar'); cal.innerHTML="";
const date=new Date(APP.year,APP.month,1);
const weekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
weekdays.forEach(d=>{let wd=document.createElement('div');wd.className="weekday";wd.textContent=d;cal.appendChild(wd);});
let firstDay=date.getDay();
for(let i=0;i<firstDay;i++) cal.appendChild(document.createElement('div'));
const monthDays=new Date(APP.year,APP.month+1,0).getDate();
for(let d=1;d<=monthDays;d++){
let dayDiv=document.createElement('div'); dayDiv.className="day"; dayDiv.textContent=d;
let fest=getFestivals(APP.year,APP.month+1,d);
if(fest.length>0) dayDiv.classList.add('festival');
dayDiv.addEventListener('click',()=>showDayDetails(APP.year,APP.month+1,d));
cal.appendChild(dayDiv);
}
}

// Day details
function showDayDetails(y,m,d){
const det=document.getElementById('day-details');
let date=new Date(y,m-1,d);
let sun=getSunTimes(date,APP.lat,APP.lon,APP.tz);
let p={muhurta:getMuhurtas()};
let details=`Date: ${d}-${m}-${y}
Latitude: ${APP.lat}
Longitude: ${APP.lon}
Timezone: ${APP.tz}
Sunrise: ${sun.sunrise}h
Sunset: ${sun.sunset}h
Tithi: ${getTithi(date)}
Yoga: ${getYoga(date)}
Karana: ${getKarana(date)}
Festivals: ${getFestivals(y,m,d).join(", ")||"None"}
Muhurta:
  Rahu Kalam: ${p.muhurta.Rahu}
  Yamaganda: ${p.muhurta.Yamaganda}
  Gulika: ${p.muhurta.Gulika}
  Abhijit Muhurta: ${p.muhurta.Abhijit}
  Good Time: ${p.muhurta.GoodTime}`;
det.textContent=details;
}

// Inputs
document.getElementById('yearInput').addEventListener('change',e=>{APP.year=parseInt(e.target.value);renderCalendar();});
document.getElementById('monthInput').addEventListener('change',e=>{let val=parseInt(e.target.value); if(val>=1 && val<=12) APP.month=val-1; renderCalendar();});

// Initial render fallback
setTimeout(()=>{if(!APP.lat||!APP.lon) renderCalendar();},500);
</script>
</body>
</html>
